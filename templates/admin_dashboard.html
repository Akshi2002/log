{% extends "base.html" %}

{% block title %}Admin Dashboard - Attendance System{% endblock %}

{% block extra_css %}
<style>
    .stats-card {
        transition: all 0.3s ease;
        border-radius: 12px;
    }
    
    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    }
    
    .stats-card .card-body {
        padding: 2rem 1.5rem;
    }
    
    .stats-card .fa-3x {
        transition: all 0.3s ease;
    }
    
    .stats-card:hover .fa-3x {
        transform: scale(1.1);
    }
    
    .stats-card .card-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .stats-card .card-text {
        font-size: 0.95rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
</style>
{% endblock %}


{% block content %}
<div class="p-4 mb-4" style="background: linear-gradient(135deg, #8a2be2 0%, #b666d2 50%, #6c4bc5 100%); border-radius: 24px; color: white; position: relative; min-height: 140px;">
        <div class="d-flex justify-content-between align-items-start">
            <div>
            <div class="small" style="opacity:.85">Product Name</div>
            </div>
        <div class="d-flex align-items-center flex-wrap" style="gap:.5rem;">
            <a href="{{ url_for('admin_manage_team') }}" class="btn btn-light btn-sm rounded-pill px-3">Manage Team</a>
            <a href="{{ url_for('admin_employees') }}" class="btn btn-light btn-sm rounded-pill px-3">Manage Employees</a>
            <a href="{{ url_for('admin_attendance') }}" class="btn btn-light btn-sm rounded-pill px-3">View Attendance</a>
            <a href="{{ url_for('admin_timesheets') }}" class="btn btn-light btn-sm rounded-pill px-3">Employee Timesheets</a>
            <a href="{{ url_for('admin_attendance', date=datetime.now().strftime('%Y-%m-%d')) }}" class="btn btn-light btn-sm rounded-pill px-3">Today's Report</a>
            <a href="#" class="btn btn-light btn-sm rounded-pill px-3" title="Calendar (to be wired)">Calendar</a>
            <a href="{{ url_for('admin_logout') }}" class="rounded-circle bg-white bg-opacity-25 p-3 ms-1 text-decoration-none" title="Logout">
                <i data-lucide="log-out" class="text-white"></i>
            </a>
        </div>
    </div>
    <div class="position-absolute" style="left: 18px; bottom: 12px;">
        <h5 class="mb-1">Hi {{ current_user.name }}</h5>
        <div class="small" style="opacity:.9">{{ (datetime.now()).strftime('%A, %d %b %Y') }}</div>
    </div>
</div>



<!-- Personal Timesheet (Recent) -->
<div class="card border-0 mb-4" style="border-radius: 20px; box-shadow: 0 12px 24px rgba(0,0,0,.08);">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="fw-bold">Timesheet</div>
            <i data-lucide="settings-2" class="text-muted"></i>
        </div>
        {% if recent_timesheets %}
        <div class="table-responsive">
            <table class="table table-hover align-middle" style="--bs-table-bg:#ffffff;">
                <thead style="background:#3b38ff; color:#fff;">
                    <tr>
                        <th style="border-top-left-radius:18px;">Date & Time</th>
                        <th>Employee Name</th>
                        <th>Employee ID</th>
                        <th>Department</th>
                        <th>Report Preview</th>
                        <th style="border-top-right-radius:18px;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ts in recent_timesheets %}
                    <tr>
                        <td>
                            {{ ts.date }}
                            {% if ts.submitted_at %}
                                <div class="text-muted small">{{ ts.submitted_at[11:19] }}</div>
                            {% endif %}
                        </td>
                        <td>{{ (employees_dict.get(ts.employee_id).name) if employees_dict.get(ts.employee_id) else '' }}</td>
                        <td>{{ ts.employee_id }}</td>
                        <td>{{ (employees_dict.get(ts.employee_id).department) if employees_dict.get(ts.employee_id) else '' }}</td>
                        <td class="text-muted small">{{ ts.tasks_completed or ts.achievements or ts.additional_notes or 'â€”' }}</td>
                        <td><a href="{{ url_for('admin_timesheets', employee_id=ts.employee_id) }}" class="text-decoration-none" title="View all timesheets for this employee"><i data-lucide="external-link"></i></a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="text-center">
            <a href="{{ url_for('admin_timesheets') }}" class="btn btn-light border rounded-pill px-3">Load More</a>
        </div>
        {% else %}
        <div class="text-muted small">No recent entries.</div>
        {% endif %}
    </div>
</div>



<!-- Today's Attendance -->
<div class="card border-0 mb-4" style="border-radius:20px; box-shadow:0 12px 24px rgba(0,0,0,.08);">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="fw-bold">Today's Attendance</div>
        </div>
        <div class="d-flex flex-wrap gap-3 mb-3">
            <span class="px-3 py-2" style="background:#6c4bc5;color:#fff;border-radius:999px;">Total Members : {{ total_employees }}</span>
            <span class="px-3 py-2" style="background:#6c4bc5;color:#fff;border-radius:999px;">Present today : {{ signed_in_today }}/{{ total_employees }}</span>
            <span class="px-3 py-2" style="background:#6c4bc5;color:#fff;border-radius:999px;">WFH : {{ wfh_today|default(0) }}/{{ total_employees }}</span>
            {% set online_count = (today_attendance | selectattr('sign_in_time') | rejectattr('sign_out_time') | list | length) if today_attendance else 0 %}
            <span class="px-3 py-2 d-inline-flex align-items-center" style="background:#6c4bc5;color:#fff;border-radius:999px;">
                <span style="display:inline-block;width:10px;height:10px;background:#22c55e;border-radius:999px;margin-right:8px;"></span>
                Online : {{ online_count }}/{{ total_employees }}
            </span>
            </div>
                {% if today_attendance %}
                <div class="table-responsive">
            <table class="table table-hover align-middle" style="--bs-table-bg:#ffffff;">
                <thead style="background:#6c4bc5;color:#fff;">
                            <tr>
                        <th style="border-top-left-radius:18px;">Employee Name</th>
                                <th>Employee ID</th>
                                <th>Department</th>
                        <th>Login Time</th>
                        <th>Logoff Time</th>
                        <th>Uptime</th>
                        <th style="border-top-right-radius:18px;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for attendance in today_attendance %}
                            <tr>
                                <td>
                                    {% for employee in employees %}
                                        {% if employee.employee_id == attendance.employee_id %}
                                            {{ employee.name }}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                        <td class="text-muted">{{ attendance.employee_id }}</td>
                                <td>
                                    {% for employee in employees %}
                                        {% if employee.employee_id == attendance.employee_id %}
                                            <span class="badge bg-secondary">{{ employee.department }}</span>
                                        {% endif %}
                                    {% endfor %}
                                </td>
                                <td>
                                    {% if attendance.sign_in_time %}
                                {{ attendance.get_sign_in_datetime().strftime('%I:%M %p') if attendance.get_sign_in_datetime() }}
                            {% else %}-{% endif %}
                                </td>
                                <td>
                                    {% if attendance.sign_out_time %}
                                {{ attendance.get_sign_out_datetime().strftime('%I:%M %p') if attendance.get_sign_out_datetime() }}
                            {% else %}<span class="text-success">Online</span>{% endif %}
                                </td>
                                <td>
                                    {% if attendance.total_hours %}
                                {{ "%.2f"|format(attendance.total_hours) }} hr
                            {% else %}-{% endif %}
                                </td>
                                <td>
                                    {% if attendance.sign_in_time and not attendance.sign_out_time %}
                                <span class="badge bg-success">Online</span>
                                    {% elif attendance.sign_out_time %}
                                <span class="badge bg-secondary">Offline</span>
                                    {% else %}
                                <span class="badge bg-secondary">Offline</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
        <div class="text-center">
            <a href="{{ url_for('admin_attendance') }}" class="small text-decoration-none" style="color:#6c4bc5;">View Complete List</a>
        </div>
                {% else %}
                <div class="text-center py-4">
            <i class="fas fa-calendar-times fa-3x text-muted mb-2"></i>
            <div class="text-muted">No attendance records for today</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions moved to header -->
{% endblock %} 

{# Footer #}